name: Build iOS App

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:  # Permite la ejecución manual
jobs:
  build-ios:
    runs-on: macos-latest
    steps:
      - name: 📥 Clonar el repositorio
        uses: actions/checkout@v4

      - name: 🔧 Configurar JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: 🛠️ Configurar Gradle
        uses: gradle/gradle-build-action@v3

      - name: 🔽 Instalar Ruby y CocoaPods
        run: |
          sudo gem install cocoapods
          pod --version

      - name: 🚀 Configurar Gradle Wrapper
        run: chmod +x ./gradlew

      - name: 📦 Instalar dependencias de CocoaPods
        run: |
          cd iosApp
          pod install

      - name: 🏗️ Compilar el Framework de iOS
        run: |
          chmod +x gradlew
          ./gradlew :composeApp:assembleXCFramework  # Ejecutamos la tarea que genera el XCFramework  
          
      - name: Verify XCFramework directory exists
        run: |
          if [ -d "composeApp/build" ]; then
            echo "Directory exists!"
          else
            echo "Directory does not exist!"
          fi

      - name: ✅ Verificar que la build fue exitosa
        run: ls -l composeApp/build/XCFrameworks/release
