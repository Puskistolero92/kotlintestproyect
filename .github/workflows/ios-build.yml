name: Build iOS App

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:  # Permite la ejecución manual
jobs:
  build-ios:
    runs-on: macos-latest
    steps:
      - name: 📥 Clonar el repositorio
        uses: actions/checkout@v4

      - name: 🔧 Configurar JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: 🛠️ Configurar Gradle
        uses: gradle/gradle-build-action@v3

      - name: 🔽 Instalar Ruby y CocoaPods
        run: |
          sudo gem install cocoapods
          pod --version

      - name: 🚀 Configurar Gradle Wrapper
        run: chmod +x ./gradlew

      - name: 📦 Instalar dependencias de CocoaPods
        run: |
          cd iosApp
          pod install

      - name: 🏗️ Compilar el Framework de iOS
        run: |
          chmod +x gradlew
          ./gradlew :composeApp:assembleXCFramework  # Ejecutamos la tarea que genera el XCFramework  
          
      - name: ✅ Verificar que la build fue exitosa
        run: ls -l composeApp/build/bin/iosArm64/releaseFramework/
        
      - name: ✅ Verificar que la build fue exitosa
        run: ls -l composeApp/build/bin/iosX64/releaseFramework/shared.framework
         
      - name: Upload iOS Frameworks
        uses: actions/upload-artifact@v4
        with:
            name: shared-frameworks
            path: |
             composeApp/build/bin/iosArm64/releaseFramework/shared.framework
             composeApp/build/bin/iosX64/releaseFramework/shared.framework
